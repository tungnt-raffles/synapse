{
	"name": "Huy",
	"properties": {
		"content": {
			"query": "--test\n---Standardized.L_CUSTOMER_CARD\nCREATE PROCEDURE L_CUSTOMER_CARD_ETL @data_date date\nAS BEGIN\n    TRUNCATE TABLE [Standardized].[L_CUSTOMER_CARD];\n\tINSERT INTO [Standardized].[L_CUSTOMER_CARD]\n    SELECT\n\n        Standardized.FunctionHashMD5('CUSTOMER_CARD' + '-' + b.client_number + '-' + a.id + '-' + a.contract_number) AS [Customer_X_Card Hashkey]\n\n        ,Standardized.FunctionHashMD5('CUSTOMER' + '-' + b.client_number ) AS [Customer HashKey]\n\n        ,Standardized.FunctionHashMD5('CARD' + '-' + a.id + '-' + a.contract_number) AS [Card HashKey]\n\n        ,'LandingBank.Card' AS [Record Source]\n\n        ,CONVERT(date, GETDATE() ,103) AS [Load Date]\n\n    FROM [LandingBank].[Card]  a \n\n    INNER JOIN [LandingBank].[CardClient]  b on b.data_date=@data_date and b.amnd_state='A' and b.id=a.client__id\n\n    where a.data_date=@data_date and a.amnd_state='A' and a.con_cat='C' and a.base_relation is null \nEND;\nEXEC L_CUSTOMER_CARD_ETL '2022-08-31';\nDROP PROCEDURE L_CUSTOMER_CARD_ETL;\nselect * from [Standardized].[L_CUSTOMER_CARD];\n\n\n---Standardized.S_CARD\nCREATE PROCEDURE S_CARD_ETL @data_date date\nAS BEGIN\n    TRUNCATE TABLE [Standardized].[S_CARD];\n\tINSERT INTO [Standardized].[S_CARD]\n    SELECT\n\n        Standardized.FunctionHashMD5('CARD' + '-' + a.id + '-' + a.contract_number) AS [Card HashKey]\n\n        , a.date_open AS [Card Open Date]\n\n        , COALESCE(a.date_expire, '2400-01-01') AS [Card Expiry Date]\n\n        , a.card_classifier_name AS [Card Class]\n\n        ,'LandingBank.Card' AS [Record Source]\n\n        ,CONVERT(date, GETDATE() ,103) AS [Load Date]\n\n    FROM [LandingBank].[Card]  a \n\n    --INNER JOIN [LandingBank].[CardClient]  b on b.data_date=20220831 and b.amnd_state='A' and b.id=a.client__id\n\n    where a.data_date=@data_date and a.amnd_state='A' and a.con_cat='C' and a.base_relation is null \nEND;\n\n---Standardized.S_ACCOUNT\nCREATE PROCEDURE S_ACCOUNT_ETL @data_date date\nAS BEGIN\n    TRUNCATE TABLE [Standardized].[S_ACCOUNT];\n\tINSERT INTO [Standardized].[S_ACCOUNT]\n    SELECT\n\n    Standardized.FunctionHashMD5('ACCOUNT' + '-' + a.id + '-' + a.contract_number) AS [Account HashKey]\n\n    , a.contr_status AS [Account Status]\n\n    ,'LandingBank.Card' AS [Record Source]\n\n    ,CONVERT(date, GETDATE() ,103) AS [Load Date]\n\n    ,CONVERT(date, '2400-01-01' ,126) as [Load End Date]\n\n    FROM [LandingBank].[Card]  a \n    where a.data_date=@data_date and a.amnd_state='A' and a.con_cat='A' and a.contract_number not like '%-L-L%' \n\nEND;\nEXEC S_ACCOUNT_ETL '2022-08-31';\nDROP PROCEDURE S_ACCOUNT_ETL;\nselect * from [Standardized].[S_ACCOUNT];\n\n---Standardized.S_CUSTOMER_CONTACT\nCREATE PROCEDURE S_CUSTOMER_CONTACT_ETL @data_date date\nAS BEGIN\n    TRUNCATE TABLE [Standardized].[S_CUSTOMER_CONTACT];\n\tINSERT INTO [Standardized].[S_CUSTOMER_CONTACT]\n    SELECT \n\n    Standardized.FunctionHashMD5('CUSTOMER' + '-' + a.id ) AS [Customer HashKey]\n\n    ,a.t_email_1 [Email]\n\n    ,a.t_phone_1 [Phone]\n\n    ,a.t_address [Address]\n\n    ,'LandingBank.Customer' AS [Record Source]\n\n    ,CONVERT(date, GETDATE() ,103) AS [Load Date]\n\n    ,CONVERT(date, '2400-01-01' ,126) as [Load End Date]\n\n FROM [LandingBank].[Customer]  a \n\nwhere a.data_date=@data_date \nEND;\n\n\n---Standardized.S_CUSTOMER_DEMO\nCREATE PROCEDURE S_CUSTOMER_DEMO_ETL @data_date date\nAS BEGIN\n    TRUNCATE TABLE [Standardized].[S_CUSTOMER_DEMO];\n\tINSERT INTO [Standardized].[S_CUSTOMER_DEMO]\nSELECT \n\n    Standardized.FunctionHashMD5('CUSTOMER' + '-' + a.id ) AS [Customer HashKey]\n\n    ,a.t_name_1 AS [Name]\n\n    ,a.t_gender AS [Gender]\n\n    ,t_marital_status AS [Marital Status]\n\n    ,t_nationality AS [Country of Citizen]\n\n    ,t_job_title AS [Employmen Position]\n\n    ,t_net_monthly_in AS [Living Standard]\n\n    ,'LandingBank.Customer' AS [Record Source]\n\n    ,CONVERT(date, GETDATE() ,103) AS [Load Date]\n\n    ,CONVERT(date, '2400-01-01' ,126) as [Load End Date]\n\n  FROM [LandingBank].[Customer]  a \n\nwhere a.data_date=@data_date\nEND;\n\n\n---Standardized.S_CUSTOMER_GEN_INFO\nCREATE PROCEDURE S_CUSTOMER_GEN_INFO_ETL @data_date date\nAS BEGIN\n    TRUNCATE TABLE [Standardized].[S_CUSTOMER_GEN_INFO];\n\tINSERT INTO [Standardized].[S_CUSTOMER_GEN_INFO]\nSELECT \n\n    Standardized.FunctionHashMD5('CUSTOMER' + '-' + a.id ) AS [Customer HashKey]\n\n    , a.t_sector as [Segment]\n\n    ,'LandingBank.Customer' AS [Record Source]\n\n    ,CONVERT(date, GETDATE() ,103) AS [Load Date]\n\n    ,CONVERT(date, '2400-01-01' ,126) as [Load End Date]\n\n FROM [LandingBank].[Customer]  a \n\nwhere a.data_date=@data_date\nEND\n;\n\n---Standardized.S_TRANSACTION_TURNOVER\nCREATE PROCEDURE S_TRANSACTION_TURNOVER_ETL @data_date date\nAS BEGIN\n    TRUNCATE TABLE [Standardized].[S_TRANSACTION_TURNOVER];\n\tINSERT INTO [Standardized].[S_TRANSACTION_TURNOVER]\nSELECT\n\n    Standardized.FunctionHashMD5('TRANSACTION' + '-' + a.id ) AS [Transaction HashKey]\n\n    , convert(decimal(20,0) ,a.Settl_Amount) as [Transaction Amount]\n\n    ,'LandingBank.CardTransaction' AS [Record Source]\n\n    ,CONVERT(date, GETDATE() ,103) AS [Load Date]\n\n    ,CONVERT(date, '2400-01-01' ,126) as [Load End Date]\n\n FROM [LandingBank].[CardTransaction]  a \n\nwhere a.data_date=@data_date and a.amnd_state='A'\nEND;\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "raffles_synapse",
				"poolName": "raffles_synapse"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}